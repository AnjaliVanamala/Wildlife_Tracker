{% extends "base.html" %}
{% block content %}
<h2>Record Sightings</h2>

<form method="POST" id="sightingsForm">
  <table border="1" cellpadding="6" style="border-collapse: collapse; width: 100%;">
    <thead>
      <tr>
        <th>Animal</th>
        <th>Location</th>
        <th>Date</th>
        <th>Time</th>
        <th>Total #</th>
        <th>Breakdown?</th>
        <th>Male</th>
        <th>Female</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody id="sightingsTable">
      <tr>
        <td><input type="text" name="animal[]" required></td>
        <td><input type="text" name="location[]" required></td>
        <td><input type="date" name="day[]" required></td>
        <td><input type="time" name="time[]"></td>
        <td><input type="number" name="number[]" min="1" required></td>
        <td>
          <select name="sex_breakdown[]" onchange="toggleSexFields(this)">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </td>
        <td><input type="number" name="male_count[]" min="0" disabled></td>
        <td><input type="number" name="female_count[]" min="0" disabled></td>
        <td><button type="button" onclick="removeRow(this)">❌</button></td>
      </tr>
    </tbody>
  </table>

  <br>
  <button type="button" onclick="addRow()">➕ Add Sighting</button>
  <button type="submit">Submit All</button>
</form>

<hr>
<a href="{{ url_for('dashboard') }}"><button>Back to Dashboard</button></a>

<script>
function toggleSexFields(select) {
  const row = select.closest('tr');
  const maleInput = row.querySelector('input[name="male_count[]"]');
  const femaleInput = row.querySelector('input[name="female_count[]"]');
  const enable = select.value === 'yes';
  maleInput.disabled = !enable;
  femaleInput.disabled = !enable;
}

function addRow() {
  const table = document.getElementById('sightingsTable');
  const newRow = table.rows[0].cloneNode(true);
  newRow.querySelectorAll('input').forEach(input => {
    input.value = '';
    if (input.name.includes('male') || input.name.includes('female')) {
      input.disabled = true;
    }
  });
  newRow.querySelector('select').value = 'no';
  table.appendChild(newRow);
}

function removeRow(button) {
  const table = document.getElementById('sightingsTable');
  if (table.rows.length > 1) {
    button.closest('tr').remove();
  } else {
    alert("You must have at least one sighting row.");
  }
}
</script>

{% endblock %}
